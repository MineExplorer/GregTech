var Alloy = 
[
[ItemID.carbonPlate, 1, 20, 3, BlockID.reinforcedGlass, 4],
[ItemID.plateAlloy, 1, 20, 3, BlockID.reinforcedGlass, 4],
[ItemID.CopperDust, 3, ItemID.TinDust, 1, ItemID.BronzeIngot, 4],
[ItemID.CopperIngot, 3, ItemID.TinIngot, 1, ItemID.BronzeIngot, 4],
[ItemID.CopperDust, 3, ItemID.TinIngot, 1, ItemID.BronzeIngot, 4],
[ItemID.CopperIngot, 3, ItemID.TinDust, 1, ItemID.BronzeIngot, 4],

//nuggets
[ItemID.CopperIngot, 1, ItemID.MoldNuggets, 0, ItemID.CopperNugget, 9],
[ItemID.RubberIngot, 1, ItemID.MoldNuggets, 0, ItemID.RubberNugget, 9],
[265, 1, ItemID.MoldNuggets, 0, ItemID.IronNugget, 9],
[ItemID.LeadIngot, 1, ItemID.MoldNuggets, 0, ItemID.LeadNugget, 9],
[266, 1, ItemID.MoldNuggets, 0, ItemID.GoldNugget, 9],
[ItemID.BronzeIngot, 1, ItemID.MoldNuggets, 0, ItemID.BronzeNugget, 9],
[ItemID.TinIngot, 1, ItemID.MoldNuggets, 0, ItemID.TinNugget, 9],
[ItemID.SteelIngot, 1, ItemID.MoldNuggets, 0, ItemID.SteelNugget, 9],
[ItemID.SilverIngot, 1, ItemID.MoldNuggets, 0, ItemID.SilverNugget, 9],
[ItemID.AntimonyIngot, 1, ItemID.MoldNuggets, 0, ItemID.AntimonyNugget, 9],


//ingots
[ItemID.AntimonyNugget, 9, ItemID.MoldIngot, 0, ItemID.AntimonyIngot, 1],
[ItemID.RubberNugget, 9, ItemID.MoldIngot, 0, ItemID.RubberIngot, 1],
[ItemID.TinyPileRubberDust, 9, ItemID.MoldIngot, 0, ItemID.RubberIngot, 1],
[ItemID.SmallPileRubberDust, 4, ItemID.MoldIngot, 0, ItemID.RubberIngot, 1],
[ItemID.RubberDust, 1, ItemID.MoldIngot, 0, ItemID.RubberIngot, 1],
[ItemID.BronzeNugget, 9, ItemID.MoldIngot, 0, ItemID.BronzeIngot, 1],
[ItemID.TinNugget, 9, ItemID.MoldIngot, 0, ItemID.TinIngot, 1],
[ItemID.CopperNugget, 9, ItemID.MoldIngot, 0, ItemID.CopperIngot, 1],
[ItemID.SilverNugget, 9, ItemID.MoldIngot, 0, ItemID.SilverIngot, 1],
[ItemID.LeadNugget, 9, ItemID.MoldIngot, 0, ItemID.LeadIngot, 1],
[ItemID.GoldNugget, 9, ItemID.MoldIngot, 0, 266, 1],
[ItemID.IronNugget, 9, ItemID.MoldIngot, 0, 265, 1],
[ItemID.LongIronRod, 1, ItemID.MoldIngot, 0, 265, 1],
[ItemID.TinyPileTinDust, 9, ItemID.MoldIngot, 0, ItemID.TinIngot, 1],
[ItemID.SmallPileTinDust, 4, ItemID.MoldIngot, 0, ItemID.TinIngot, 1],
[ItemID.SmallPileCopperDust, 4, ItemID.MoldIngot, 0, ItemID.CopperIngot, 1],
[ItemID.TinyPileCopperDust, 9, ItemID.MoldIngot, 0, ItemID.CopperIngot, 1],
[ItemID.TinyPileIronDust, 9, ItemID.MoldIngot, 0, 265, 1],
[ItemID.TinyPileLeadDust, 9, ItemID.MoldIngot, 0, ItemID.LeadIngot, 1],
[ItemID.SmallPileLeadDust, 4, ItemID.MoldIngot, 0, ItemID.LeadIngot, 1],
[ItemID.SmallPileIronDust, 4, ItemID.MoldIngot, 0, 265, 1],
[ItemID.TinyPileSilverDust, 9, ItemID.MoldIngot, 0, ItemID.SilverIngot, 1],
[ItemID.SmallPileSilverDust, 4, ItemID.MoldIngot, 0, ItemID.SilverIngot, 1],
[ItemID.IronPlate, 1, ItemID.MoldIngot, 0, 265, 1],
[ItemID.SmallPileBronzeDust, 4, ItemID.MoldIngot, 0, ItemID.BronzeIngot, 1],
[ItemID.SmallPileGoldDust, 4, ItemID.MoldIngot, 0, 266, 1],
[ItemID.TinyPileAntimonyDust, 9, ItemID.MoldIngot, 0, ItemID.AntimonyIngot, 1],
[ItemID.SmallPileAntimonyDust, 4, ItemID.MoldIngot, 0, ItemID.AntimonyIngot, 1],
[ItemID.TinyPileGoldDust, 9, ItemID.MoldIngot, 0, 266, 1],
[ItemID.TinyPileBronzeDust, 9, ItemID.MoldIngot, 0, ItemID.BronzeIngot, 1],
[ItemID.BronzeDust, 1, ItemID.MoldIngot, 0, ItemID.BronzeIngot, 1],
[ItemID.RubberDust, 1, ItemID.MoldIngot, 0, ItemID.RubberIngot, 1],
[ItemID.CopperDust, 1, ItemID.MoldIngot, 0, ItemID.CopperIngot, 1],
[ItemID.TinDust, 1, ItemID.MoldIngot, 0, ItemID.TinIngot, 1],
[ItemID.IronDust, 1, ItemID.MoldIngot, 0, 265, 1],
[ItemID.GoldDust, 1, ItemID.MoldIngot, 0, 266, 1],
[ItemID.SilverDust, 1, ItemID.MoldIngot, 0, ItemID.SilverIngot, 1],
[ItemID.AntimonyDust, 1, ItemID.MoldIngot, 0, ItemID.AntimonyIngot, 1],
[ItemID.LeadDust, 1, ItemID.MoldIngot, 0, ItemID.LeadIngot, 1],

//plates
[ItemID.RubberIngot, 2, ItemID.MoldPlate, 0, ItemID.RubberPlate, 1],
[ItemID.RubberDust, 2, ItemID.MoldPlate, 0, ItemID.RubberPlate, 1],
[ItemID.SteelIngot, 2, ItemID.MoldPlate, 0, ItemID.SteelPlate, 1],
[265, 2, ItemID.MoldPlate, 0, ItemID.IronPlate, 1],
[ItemID.CopperIngot, 2, ItemID.MoldPlate, 0, ItemID.CopperPlate, 1],
[ItemID.BronzeIngot, 2, ItemID.MoldPlate, 0, ItemID.BronzePlate, 1],
[ItemID.SilverIngot, 2, ItemID.MoldPlate, 0, ItemID.SilverPlate, 1],
[ItemID.TinIngot, 2, ItemID.MoldPlate, 0, ItemID.TinPlate, 1],
[266, 2, ItemID.MoldPlate, 0, ItemID.GoldPlate, 1],
[ItemID.LeadIngot, 2, ItemID.MoldPlate, 0, ItemID.LeadPlate, 1],
[ItemID.AntimonyIngot, 2, ItemID.MoldPlate, 0, ItemID.AntimonyPlate, 1],


[ItemID.SteelDust, 2, ItemID.MoldPlate, 0, ItemID.SteelPlate, 1],
[ItemID.IronDust, 2, ItemID.MoldPlate, 0, ItemID.IronPlate, 1],
[ItemID.CopperDust, 2, ItemID.MoldPlate, 0, ItemID.CopperPlate, 1],
[ItemID.BronzeDust, 2, ItemID.MoldPlate, 0, ItemID.BronzePlate, 1],
[ItemID.SilverDust, 2, ItemID.MoldPlate, 0, ItemID.SilverPlate, 1],
[ItemID.TinDust, 2, ItemID.MoldPlate, 0, ItemID.TinPlate, 1],
[ItemID.GoldDust, 2, ItemID.MoldPlate, 0, ItemID.GoldPlate, 1],
[ItemID.LeadDust, 2, ItemID.MoldPlate, 0, ItemID.LeadPlate, 1],
[ItemID.AntimonyDust, 2, ItemID.MoldPlate, 0, ItemID.AntimonyPlate, 1],

//anvil
[265, 31, ItemID.MoldAnvil, 0, 145, 1],
];

Translation.addTranslation("Steam Alloy Smelter", {ru: "Паровая плавильня",  zh: "蒸汽铸造"});

IDRegistry.genBlockID("SteamAlloySmelter");
Block.createBlockWithRotation("SteamAlloySmelter", [
{name: "Steam Alloy Smelter", texture: [["MACHINE_BRONZEBRICKS_BOTTOM", 0], ["MACHINE_BRONZE", 0], ["MACHINE_BRONZEBRICKS", 0], ["MACHINE_BRONZE_ALLOYSMELTER", 0], ["MACHINE_BRONZEBRICKS", 0], ["MACHINE_BRONZEBRICKS", 0],], inCreative: true}
]);

Callback.addCallback("PostLoaded", function(){
	Recipes.addShaped({id: BlockID.SteamAlloySmelter, count: 1, data: 0}, [
		"bbb",
		"fcf",
		"bbb"
	], ['b', BlockID.SmallBronzeFluidPipe, 0, 'c', BlockID.BrikedBronzeHull, 0, 'f', 61, 0]);
});

var guiSteamAlloySmelter = new UI.StandartWindow({
    standart: {
        header: {text: {text: "Steam Alloy Smelter"}},
        inventory: {standart: true},
        background: { bitmap: "BronzeBG"}
    },
	params: {
         
               slot: "BronzeSlot",
               invSlot: "BronzeSlot"
     

     },

    
    drawing: [
            {type: "bitmap", x: 530, y: 153, bitmap: "BronzeProgressBG", scale: 3.2},
            {type: "bitmap", x: 900, y: 400, bitmap: "GTLogoBronze", scale: 4},     
    ],
	
    
    elements: {
        "slotSource": {type: "slot", x: 381, y: 150, bitmap: "bronzeSlotFire"},
		"slotSource2": {type: "slot", x: 441, y: 150, bitmap: "bronzeSlotFire"},
		"slotResult": {type: "slot", x: 625, y: 150},		
		"progressScale": {type: "scale", x: 530, y: 150, direction: 0, value: 0, bitmap: "BronzeProgressScale", scale: 3.2},
    }
});


SteamMachineRegistry.register(BlockID.SteamAlloySmelter, {
	defaultValues: {
		energy_consumption: 16,
		work_time: 200,
		progress: 0,
		gazLevel: 0
	},
	
	getGuiScreen: function(){
		return guiSteamAlloySmelter;
	},
	
	setDefaultValues: function(){
		this.data.energy_consumption = this.defaultValues.energy_consumption;
		this.data.work_time = this.defaultValues.work_time;
	},
	
	
	tick: function(){
		this.setDefaultValues();
		var content = this.container.getGuiContent();
		var sourceSlot = this.container.getSlot("slotSource");
		var sourceSlot2 = this.container.getSlot("slotSource2");
		var resultSlot = this.container.getSlot("slotResult");
		for (var a in Alloy){			
			if (sourceSlot.id == Alloy[a][0]&& sourceSlot2.id == Alloy[a][2]&& sourceSlot.count >= Alloy[a][1]&& sourceSlot2.count >= Alloy[a][3]&& (resultSlot.id == Alloy[a][4] || 0) && resultSlot.count < 64){
				if(this.data.steam >= this.data.energy_consumption){
					this.data.steam -= this.data.energy_consumption;
					this.data.progress += 1/this.data.work_time;
				}else{
            this.data.progress = 0;
        }
			
				if(this.data.progress >= 1 && this.data.gazLevel == 0){
                    
					sourceSlot.count -= Alloy[a][1];
					sourceSlot2.count -= Alloy[a][3];
					resultSlot.id = Alloy[a][4];
					resultSlot.data = 0;
					resultSlot.count += Alloy[a][5];
					this.container.validateAll();
					this.data.progress = 0;
				}
			}
		}
		this.container.setScale("progressScale", this.data.progress);
	},
					
	getEnergyStorage: function(){
		return 16000;
	},
	energyTick: SteamMachineRegistry.basicEnergyReceiveFunc	
});
